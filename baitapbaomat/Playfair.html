<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Playfair Cipher</title>
  <style>
    body {
      font-family: monospace;
      background: #f0f4f8;
      color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background: #fff;
      border: 2px solid #444;
      border-radius: 10px;
      box-shadow: 4px 4px 12px rgba(0,0,0,0.2);
      padding: 20px 30px;
      max-width: 600px;
      width: 100%;
    }
    .title {
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      margin-bottom: 15px;
    }
    input {
      font-family: monospace;
      padding: 8px;
      margin: 6px 0;
      width: 100%;
      border: 1px solid #aaa;
      border-radius: 5px;
      font-size: 14px;
    }
    button {
      font-family: monospace;
      font-size: 14px;
      padding: 8px 14px;
      margin-top: 10px;
      background: #222;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #444;
    }
    .output {
      margin-top: 15px;
      padding: 10px;
      background: #fafafa;
      border: 1px dashed #666;
      border-radius: 5px;
      white-space: pre-line;
    }
    .label {
      margin-top: 10px;
      display: block;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">=== Playfair Cipher ===</div>

    <label class="label">Nhap plaintext (chu hoa, khong dau):</label>
    <input type="text" id="plaintext" placeholder="HELLO">

    <label class="label">> Nhap khoa (chu hoa, khong dau):</label>
    <input type="text" id="key" placeholder="LINH">

    <button onclick="run()">Thuc hien</button>

    <div class="output">
      --- Ket qua ---<br>
      Ma hoa: <span id="mahoa"></span><br>
      Giai ma: <span id="giaima"></span>
    </div>
  </div>

<script>
// Tạo ma trận Playfair (5x5)
function createMatrix(key) {
  key = key.toUpperCase().replace(/J/g, "I").replace(/[^A-Z]/g, "");
  let matrix = [];
  let used = {};
  let letters = key + "ABCDEFGHIKLMNOPQRSTUVWXYZ"; // J gộp với I
  for (let i = 0; i < letters.length; i++) {
    let ch = letters[i];
    if (!used[ch]) {
      matrix.push(ch);
      used[ch] = true;
    }
  }
  return matrix;
}

// Chia plaintext thành cặp
function prepareText(text) {
  text = text.toUpperCase().replace(/J/g, "I").replace(/[^A-Z]/g, "");
  let result = "";
  for (let i = 0; i < text.length; i++) {
    result += text[i];
    if (i < text.length - 1 && text[i] === text[i+1]) {
      result += "X";
    }
  }
  if (result.length % 2 !== 0) result += "X";
  return result;
}

function findPos(matrix, ch) {
  let idx = matrix.indexOf(ch);
  return [Math.floor(idx/5), idx%5];
}

function encryptPair(matrix, a, b) {
  let [r1,c1] = findPos(matrix,a);
  let [r2,c2] = findPos(matrix,b);
  if (r1 === r2) {
    return matrix[r1*5 + (c1+1)%5] + matrix[r2*5 + (c2+1)%5];
  } else if (c1 === c2) {
    return matrix[((r1+1)%5)*5 + c1] + matrix[((r2+1)%5)*5 + c2];
  } else {
    return matrix[r1*5 + c2] + matrix[r2*5 + c1];
  }
}

function decryptPair(matrix, a, b) {
  let [r1,c1] = findPos(matrix,a);
  let [r2,c2] = findPos(matrix,b);
  if (r1 === r2) {
    return matrix[r1*5 + (c1+4)%5] + matrix[r2*5 + (c2+4)%5];
  } else if (c1 === c2) {
    return matrix[((r1+4)%5)*5 + c1] + matrix[((r2+4)%5)*5 + c2];
  } else {
    return matrix[r1*5 + c2] + matrix[r2*5 + c1];
  }
}

function encryptPlayfair(text, key) {
  let matrix = createMatrix(key);
  let prep = prepareText(text);
  let res = "";
  for (let i=0;i<prep.length;i+=2) {
    res += encryptPair(matrix, prep[i], prep[i+1]);
  }
  return res;
}

function decryptPlayfair(text, key) {
  let matrix = createMatrix(key);
  let res = "";
  for (let i=0;i<text.length;i+=2) {
    res += decryptPair(matrix, text[i], text[i+1]);
  }
  return res;
}

function run() {
  let pt = document.getElementById("plaintext").value.toUpperCase();
  let key = document.getElementById("key").value.toUpperCase();

  if (pt.length === 0 || key.length === 0) {
    document.getElementById("mahoa").innerText = "(Lỗi: plaintext và key phải có ký tự hợp lệ)";
    document.getElementById("giaima").innerText = "";
    return;
  }

  let ct = encryptPlayfair(pt, key);
  let rt = decryptPlayfair(ct, key);

  document.getElementById("mahoa").innerText = ct;
  document.getElementById("giaima").innerText = rt;
}
</script>
</body>
</html>
